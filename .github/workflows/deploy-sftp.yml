name: Deploy to Absolute Hosting (SFTP)

# Alternative workflow using SFTP protocol
# Use this if regular FTP deployment fails with "530 Login incorrect"
# To use: Copy the secrets setup, then commit this file and it will deploy alongside the main workflow

on:
  workflow_dispatch:  # Manual trigger only
    inputs:
      use_sftp:
        description: 'Use SFTP protocol'
        required: false
        default: 'true'

jobs:
  sftp-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: List files to deploy
        run: |
          echo "Files to be deployed:"
          ls -la
          echo ""
          echo "HTML, CSS, JS files:"
          find . -maxdepth 1 -type f \( -name "*.html" -o -name "*.css" -o -name "*.js" \) | head -10

      - name: Verify FTP Secrets
        run: |
          if [ -z "${{ secrets.FTP_SERVER }}" ]; then
            echo "❌ FTP_SERVER secret is missing!"
            exit 1
          fi
          if [ -z "${{ secrets.FTP_USERNAME }}" ]; then
            echo "❌ FTP_USERNAME secret is missing!"
            exit 1
          fi
          if [ -z "${{ secrets.FTP_PASSWORD }}" ]; then
            echo "❌ FTP_PASSWORD secret is missing!"
            exit 1
          fi
          echo "✅ All FTP secrets are configured"
          echo "FTP Server: ${{ secrets.FTP_SERVER }}"
          echo "FTP Username: ${{ secrets.FTP_USERNAME }}"

      - name: SFTP Deploy
        uses: SamKirkland/FTP-Deploy-Action@4.3.0
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: sftp
          port: 22
          local-dir: ./
          server-dir: /public_html/  # Try /public_html/, /www/, or just /
          dangerous-clean-slate: false
          log-level: verbose
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/.github/**
            README.md
            .gitignore

      - name: Deployment Summary
        if: success()
        run: |
          echo "✅ SFTP Deployment completed successfully!"

